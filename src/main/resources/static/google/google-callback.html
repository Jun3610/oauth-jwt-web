<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>êµ¬ê¸€ ë¡œê·¸ì¸ ì™„ë£Œ</title>
</head>
<body>
<h1>êµ¬ê¸€ ë¡œê·¸ì¸ ì™„ë£Œ</h1>
<div id="info"></div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");

    if (!code) {
        alert("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨: code íŒŒë¼ë¯¸í„° ì—†ìŒ");
        throw new Error("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨: code ì—†ìŒ");
    }

    fetch(`http://localhost:8080/api/google/auth?code=${encodeURIComponent(code)}`, {
        method: "POST",
        credentials: "include"
    })
        .then(res => {
            if (!res.ok) throw new Error("ì„œë²„ ì‘ë‹µ ì‹¤íŒ¨");
            return res.json();
        })
        .then(data => {
            if (data.error) {
                alert("êµ¬ê¸€ ë¡œê·¸ì¸ ì‹¤íŒ¨: " + (data.errorDescription || data.error));
                throw new Error(data.errorDescription || data.error);
            }

            const { accessToken, refreshToken, tokenType, expiresIn, user_id, user_name } = data;

            alert(`âœ… ë¡œê·¸ì¸ ì„±ê³µ!\nğŸ‘¤ ì´ë¦„: ${user_name}`);

            const info = `
            Access Token : ${accessToken}<br>
            Refresh Token: ${refreshToken}<br>
            Token Type   : ${tokenType}<br>
            Expires In   : ${expiresIn}<br>
            User ID      : ${user_id}<br>
            User Name    : ${user_name}
        `;

            document.getElementById("info").innerHTML = info;
        })
        .catch(err => {
            console.error("êµ¬ê¸€ ë¡œê·¸ì¸ ì—ëŸ¬:", err);
            alert("ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
        });
</script>
</body>
</html>
