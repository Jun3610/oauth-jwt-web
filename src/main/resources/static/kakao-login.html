<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Kakao OAuth 로그인</title>
</head>
<body>
<h1>Kakao 로그인 테스트</h1>
<button id="kakaoLoginBtn">Kakao 로그인 시작</button>

<script>
    const kakaoClientId = "여기에_카카오_클라이언트_ID"; // ⚠️ 실제 클라이언트 ID로 교체
    const redirectUri = "http://localhost:8080/kakao-login.html";

    document.getElementById("kakaoLoginBtn").addEventListener("click", () => {
        const kakaoAuthUrl = `https://kauth.kakao.com/oauth/authorize?client_id=${kakaoClientId}&redirect_uri=${redirectUri}&response_type=code`;
        window.location.href = kakaoAuthUrl;
    });

    // 로그인 후 redirect돼서 코드가 붙어있다면 → 서버로 전달
    window.onload = async () => {
        const params = new URLSearchParams(window.location.search);
        const code = params.get("code");

        if (code) {
            try {
                const response = await fetch(`http://localhost:8080/api/login/kakao?code=${code}`, {
                    method: "POST"
                });

                if (!response.ok) {
                    throw new Error("토큰 요청 실패");
                }

                const data = await response.json();
                console.log("✅ JWT 발급 완료:", data);
                document.body.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                console.error("로그인 중 에러:", error);
                alert("카카오 로그인 실패");
            }
        }
    };
</script>
</body>
</html>
