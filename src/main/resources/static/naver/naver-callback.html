<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>๋ค์ด๋ฒ ๋ก๊ทธ์ธ ์๋ฃ</title>
</head>
<body>
<h1>๋ค์ด๋ฒ ๋ก๊ทธ์ธ ์๋ฃ</h1>
<div id="info"></div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get("code");
    const state = urlParams.get("state");
    const error = urlParams.get("error");
    const errorDescription = urlParams.get("error_description");

    if (error) {
        alert("๋ค์ด๋ฒ ๋ก๊ทธ์ธ ์คํจ: " + (errorDescription || error));
        throw new Error(errorDescription || error);
    }

    if (!code || !state) {
        alert("code ๋๋ state ๋๋ฝ");
        throw new Error("code/state ์์");
    }

    fetch(`http://localhost:8080/api/naver/auth?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}`, {
        method: "GET",
        credentials: "include"
    })
        .then(res => {
            if (!res.ok) throw new Error("์๋ฒ ์๋ต ์คํจ");
            return res.json();
        })
        .then(data => {
            if (data.error) {
                alert("๋ค์ด๋ฒ ๋ก๊ทธ์ธ ์คํจ: " + (data.errorDescription || data.error));
                throw new Error(data.errorDescription || data.error);
            }

            const { accessToken, refreshToken, tokenType, expiresIn, user_id, user_name } = data;

            alert(`โ ๋ก๊ทธ์ธ ์ฑ๊ณต!\n๐ค ์ด๋ฆ: ${user_name}`);

            const info = `
            Access Token : ${accessToken}<br>
            Refresh Token: ${refreshToken}<br>
            Token Type   : ${tokenType}<br>
            Expires In   : ${expiresIn}<br>
            User ID      : ${user_id}<br>
            User Name    : ${user_name}
        `;

            document.getElementById("info").innerHTML = info;
        })
        .catch(err => {
            console.error("๋ค์ด๋ฒ ๋ก๊ทธ์ธ ์๋ฌ:", err);
            alert("๋ก๊ทธ์ธ ์ฒ๋ฆฌ ์ค ์ค๋ฅ ๋ฐ์");
        });
</script>
</body>
</html>
